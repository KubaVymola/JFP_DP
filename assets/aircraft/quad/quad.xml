<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="quad" version="2.0" release="BETA"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

    <fileheader>
        <author> Jakub VÃ½mola </author>
        <filecreationdate> 2022-10-31 </filecreationdate>
        <version> $id:quad.xml v 0.01 2022/10/31 15:32:49 Exp $ </version>
        <description> Quadrocopter </description>
    </fileheader>

    <metrics file="quad_metrics.xml" />

    <mass_balance file="quad_mass.xml" />

    <ground_reactions file="quad_ground.xml" />

    <propulsion file="quad_propulsion.xml" />

    <aerodynamics />

    <!-- ? The path is relative to {root_dir}/systems directory, hence the ".." -->
    <system file="../aircraft/quad/SensorImu_quad.xml" />
    <system file="../aircraft/quad/SensorBaro_quad.xml" />


    <!-- ==== JFP required nodes follow ==== -->

    <viz>
        <!-- Preperties will be sent via ws and can be excpected in 3d visualizer -->
        <property> simulation/sim-time-sec </property>

        <property> ext/altitude-m </property>
        <property> ext/latitude-rad </property>
        <property> ext/longitude-rad </property>

        <property> ext/ecef-q-1 </property>
        <property> ext/ecef-q-2 </property>
        <property> ext/ecef-q-3 </property>
        <property> ext/ecef-q-4 </property>

        <property> ext/cg-x-m </property>
        <property> ext/cg-y-m </property>
        <property> ext/cg-z-m </property>

        <property> propulsion/engine/propeller-rpm </property>
        <property> propulsion/engine/propeller-sense </property>
        <property> propulsion/engine/thrust-lbs </property>
        <property> propulsion/engine/yaw-angle-rad </property>
        <property> propulsion/engine/pitch-angle-rad </property>

        <property> propulsion/engine[1]/propeller-rpm </property>
        <property> propulsion/engine[1]/propeller-sense </property>
        <property> propulsion/engine[1]/thrust-lbs </property>
        <property> propulsion/engine[1]/yaw-angle-rad </property>
        <property> propulsion/engine[1]/pitch-angle-rad </property>

        <property> propulsion/engine[2]/propeller-rpm </property>
        <property> propulsion/engine[2]/propeller-sense </property>
        <property> propulsion/engine[2]/thrust-lbs </property>
        <property> propulsion/engine[2]/yaw-angle-rad </property>
        <property> propulsion/engine[2]/pitch-angle-rad </property>

        <property> propulsion/engine[3]/propeller-rpm </property>
        <property> propulsion/engine[3]/propeller-sense </property>
        <property> propulsion/engine[3]/thrust-lbs </property>
        <property> propulsion/engine[3]/yaw-angle-rad </property>
        <property> propulsion/engine[3]/pitch-angle-rad </property>
        
        <file>3d/quad.obj</file>
        <node mesh="quad_body_quad.001">
            <node mesh="front_right_prop_quad.004">
                <spinner_property> propulsion/engine/propeller-rpm  </spinner_property>
                <prop_sense_property> propulsion/engine/propeller-sense </prop_sense_property>
                <pivot>
                    <x> -0.068 </x>
                    <y>  0.09  </y>
                    <z>  0.0   </z>
                </pivot>
                <axis>
                    <x> 0.0 </x>
                    <y> 0.0 </y>
                    <z> 1.0 </z>
                </axis>
            </node>
            <node>
                <position>
                    <x> -0.07 </x>
                    <y>  0.09 </y>
                    <z> -0.01 </z>
                </position>
                <thrust_property> propulsion/engine/thrust-lbs </thrust_property>
                <engine_yaw_property> propulsion/engine/yaw-angle-rad </engine_yaw_property>
                <engine_pitch_property> propulsion/engine/pitch-angle-rad </engine_pitch_property>
            </node>

            <node mesh="aft_right_prop_quad.002">
                <spinner_property> propulsion/engine[3]/propeller-rpm </spinner_property>
                <prop_sense_property> propulsion/engine[3]/propeller-sense </prop_sense_property>
                <pivot>
                    <x> 0.065 </x>
                    <y> 0.09  </y>
                    <z> 0.0   </z>
                </pivot>
                <axis>
                    <x> 0.0 </x>
                    <y> 0.0 </y>
                    <z> 1.0 </z>
                </axis>
            </node>
            <node>
                <position>
                    <x>  0.07 </x>
                    <y>  0.09 </y>
                    <z> -0.01 </z>
                </position>
                <thrust_property> propulsion/engine[3]/thrust-lbs </thrust_property>
                <engine_pitch_property> propulsion/engine[3]/pitch-angle-rad </engine_pitch_property>
                <engine_yaw_property> propulsion/engine[3]/yaw-angle-rad </engine_yaw_property>
            </node>
            
            <node mesh="front_left_prop_quad.003">
                <spinner_property> propulsion/engine[2]/propeller-rpm </spinner_property>
                <prop_sense_property> propulsion/engine[2]/propeller-sense </prop_sense_property>
                <pivot>
                    <x> -0.065 </x>
                    <y> -0.09  </y>
                    <z>  0.0   </z>
                </pivot>
                <axis>
                    <x> 0.0 </x>
                    <y> 0.0 </y>
                    <z> 1.0 </z>
                </axis>
            </node>
            <node>
                <position>
                    <x> -0.07 </x>
                    <y> -0.09 </y>
                    <z> -0.01 </z>
                </position>
                <thrust_property> propulsion/engine[2]/thrust-lbs </thrust_property>
                <engine_pitch_property> propulsion/engine[2]/pitch-angle-rad </engine_pitch_property>
                <engine_yaw_property> propulsion/engine[2]/yaw-angle-rad </engine_yaw_property>
            </node>
            
            <node mesh="aft_left_prop_quad">
                <spinner_property> propulsion/engine[1]/propeller-rpm  </spinner_property>
                <prop_sense_property> propulsion/engine[1]/propeller-sense </prop_sense_property>
                <pivot>
                    <x>  0.065 </x>
                    <y> -0.09  </y>
                    <z>  0.0   </z>
                </pivot>
                <axis>
                    <x> 0.0 </x>
                    <y> 0.0 </y>
                    <z> 1.0 </z>
                </axis>
            </node>
            <node>
                <position>
                    <x>  0.07 </x>
                    <y> -0.09 </y>
                    <z> -0.01 </z>
                </position>
                <thrust_property> propulsion/engine[1]/thrust-lbs </thrust_property>
                <engine_pitch_property> propulsion/engine[1]/pitch-angle-rad </engine_pitch_property>
                <engine_yaw_property> propulsion/engine[1]/yaw-angle-rad </engine_yaw_property>
            </node>

            <!-- <node name="left_ailer">
                <angle_property> fcs/aileron </angle_property>
                <angle_offset> 0.0 </angle_offset>
                <pivot>
                    <x> 0.5 </x>
                    <y> -2.5 </y>
                    <z> 0.1 </z>
                </pivot>
                <axis>
                    <x> 0.0 </x>
                    <y> -1.0 </y>
                    <z> 0.05 </z>
                </axis>
            </node> -->
        </node>
    </viz>

    <user_control type="Joystick">
        <mapping>
            <from> channel_1 </from>
            <to> user_control/roll  </to>
        </mapping>

        <mapping>
            <from> channel_2 </from>
            <to> user_control/pitch  </to>
        </mapping>
    </user_control>

    <fcs_interface>
        <!-- Sends binary data taken from sim_data JSON in the given order into the FCS -->
        <!-- (each value is 64-bit double) -->
        <!-- impl_property is a property  -->
        <to_fcs>
            <property> simulation/sim-time-sec </property>

            <property> ext/longitude-deg </property>
            <property> ext/latitude-deg </property>

            <property> ext/altitude-m </property>
            <property> attitude/heading-true-rad </property>
            <property> ext/heading-true-deg </property>
            <property> ext/euler-pitch </property>
            <property> ext/euler-roll </property>
            
            <property> sensor/imu/accelX-mps2 </property>
            <property> sensor/imu/accelY-mps2 </property>
            <property> sensor/imu/accelZ-mps2 </property>

            <property> sensor/imu/gyroX-rps </property>
            <property> sensor/imu/gyroY-rps </property>
            <property> sensor/imu/gyroZ-rps </property>

            <property> sensor/imu/magX-nT </property>
            <property> sensor/imu/magY-nT </property>
            <property> sensor/imu/magZ-nT </property>

            <property> sensor/baro/presStatic-Pa </property>
            <property> sensor/baro/temp-C </property>
        </to_fcs>

        <!-- Retrieve properties from FCS (from sim_data JSON) back into JSBSim -->
        <from_fcs>
            <property> fcs/throttle-cmd-norm[0] </property>
            <property> fcs/throttle-cmd-norm[1] </property>
            <property> fcs/throttle-cmd-norm[2] </property>
            <property> fcs/throttle-cmd-norm[3] </property>

            <property> fcs/psi-est </property>
            <property> fcs/theta-est </property>
            <property> fcs/phi-est </property>
        </from_fcs>
    </fcs_interface>
    
</fdm_config>
